apiVersion: batch/v1
kind: CronJob
metadata:
  name: traffic-generator
  namespace: {{ .Release.Namespace }}
spec:
  schedule: "*/1 * * * *"  # 매 1분마다 실행
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 1
  jobTemplate:
    spec:
      template:
        metadata:
          labels:
            app: traffic-generator
        spec:
          restartPolicy: OnFailure
          containers:
          - name: curl
            image: curlimages/curl:latest
            command:
            - /bin/sh
            - -c
            - |
              echo "Generating traffic to test-app..."

              # Index
              curl -s http://test-app:8080/ || true

              # Users
              curl -s http://test-app:8080/api/users || true

              # Orders (분산 트레이싱 테스트)
              curl -s http://test-app:8080/api/orders || true

              # Error (에러 추적 테스트)
              curl -s http://test-app:8080/api/error || true

              echo "Traffic generation completed"
            resources:
              requests:
                cpu: 10m
                memory: 32Mi
              limits:
                cpu: 100m
                memory: 64Mi
