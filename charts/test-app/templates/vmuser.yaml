apiVersion: operator.victoriametrics.com/v1beta1
kind: VMUser
metadata:
  name: tenant-{{ .Values.tenantId }}
  namespace: {{ .Release.Namespace }}
spec:
  username: tenant-{{ .Values.tenantId }}
  password: tenant-{{ .Values.tenantId }}-password

  targetRefs:
    # VictoriaMetrics - Read access (vmselect)
    - crd:
        kind: VMCluster/vmselect
        name: victoria-metrics
        namespace: monitoring
      paths:
        - "/select/.*"
        - "/prometheus/api/v1/.*"
        - "/graphite/.*"
        - "/api/v1/.*"
      target_path_suffix: "/select/{{ .Values.tenantId }}"

    # VictoriaMetrics - Write access (vminsert)
    - crd:
        kind: VMCluster/vminsert
        name: victoria-metrics
        namespace: monitoring
      paths:
        - "/insert/.*"
        - "/prometheus/api/v1/write"
        - "/api/v1/write"
      target_path_suffix: "/insert/{{ .Values.tenantId }}"

    # VictoriaLogs - Read/Write access
    - static:
        url: http://vlsingle-victoria-logs.monitoring.svc:9428
        headers:
          - "AccountID: {{ .Values.tenantId }}"
          - "ProjectID: 0"
      paths:
        - "/select/.*"
        - "/insert/.*"
        - "/.*"

    # VictoriaTraces - Read/Write access
    - static:
        url: http://vtsingle-victoria-traces.monitoring.svc:10428
        headers:
          - "AccountID: {{ .Values.tenantId }}"
          - "ProjectID: 0"
      paths:
        - "/select/.*"
        - "/insert/.*"
        - "/.*"
        - "/jaeger/.*"
