grafana:
  enabled: true

  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
        - name: Loki
          uid: loki
          type: loki
          url: http://{{ .Release.Name }}-loki-gateway
          isDefault: false
        - name: Mimir
          uid: prom
          type: prometheus
          url: http://{{ .Release.Name }}-mimir-nginx/prometheus
          isDefault: true
        - name: Tempo
          uid: tempo
          type: tempo
          url: http://{{ .Release.Name }}-tempo-query-frontend:3200
          isDefault: false
          jsonData:
            tracesToLogsV2:
              datasourceUid: loki
            lokiSearch:
              datasourceUid: loki
            tracesToMetrics:
              datasourceUid: prom
            serviceMap:
              datasourceUid: prom
        - name: Pyroscope
          uid: pyroscope
          type: grafana-pyroscope-datasource
          url: http://{{ .Release.Name }}-pyroscope:4040
          isDefault: false

loki:
  enabled: true

  global:
    dnsService: coredns

mimir:
  enabled: true

  global:
    dnsService: coredns

  alertmanager:
    resources:
      requests:
        cpu: 20m
  compactor:
    resources:
      requests:
        cpu: 20m
  distributor:
    resources:
      requests:
        cpu: 20m
  ingester:
    replicas: 2
    zoneAwareReplication:
      enabled: false
    resources:
      requests:
        cpu: 20m
  overrides_exporter:
    resources:
      requests:
        cpu: 20m
  querier:
    replicas: 1
    resources:
      requests:
        cpu: 20m
  query_frontend:
    resources:
      requests:
        cpu: 20m
  query_scheduler:
    replicas: 1
    resources:
      requests:
        cpu: 20m
  ruler:
    resources:
      requests:
        cpu: 20m
  store_gateway:
    zoneAwareReplication:
      enabled: false
    resources:
      requests:
        cpu: 20m
  minio:
    resources:
      requests:
        cpu: 20m
  rollout_operator:
    resources:
      requests:
        cpu: 20m

tempo:
  enabled: true
  ingester:
    replicas: 1

grafana-oncall:
  enabled: false

pyroscope:
  enabled: true

  pyroscope:
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 1Gi

k8s-monitoring:
  enabled: true

  cluster:
    name: xquare-onpremise

  destinations:
    - name: mimir
      type: prometheus
      url: http://monitoring-mimir-nginx/prometheus/api/v1/push
    - name: loki
      type: loki
      url: http://monitoring-loki-gateway/loki/api/v1/push
    - name: tempo
      type: otlp
      url: http://monitoring-tempo-distributor:4317
    - name: pyroscope
      type: pyroscope
      url: http://monitoring-pyroscope:4040

  # Metrics collection
  clusterMetrics:
    enabled: true
    opencost:
      enabled: false # OpenCost disabled for on-premise
  annotationAutodiscovery:
    enabled: true
  prometheusOperatorObjects:
    enabled: true

  # Logs collection
  clusterEvents:
    enabled: true
  podLogs:
    enabled: true
  nodeLogs:
    enabled: false # Requires privileged access

  # Traces & Profiling
  applicationObservability:
    enabled: true
    receivers:
      otlp:
        grpc:
          enabled: true
        http:
          enabled: true
  profiling:
    enabled: true
  profilesReceiver:
    enabled: true

  # Auto-instrumentation (optional, heavy)
  autoInstrumentation:
    enabled: false

  # Required collectors
  alloy-metrics:
    enabled: true
  alloy-logs:
    enabled: true
  alloy-singleton:
    enabled: true
  alloy-receiver:
    enabled: true
    alloy:
      extraPorts:
        - name: otlp-grpc
          port: 4317
          targetPort: 4317
          protocol: TCP
        - name: otlp-http
          port: 4318
          targetPort: 4318
          protocol: TCP
        - name: profiles
          port: 4040
          targetPort: 4040
          protocol: TCP
  alloy-profiles:
    enabled: true
